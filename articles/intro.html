<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to apcf • apcf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to apcf">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">apcf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.1.99</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/intro.html">Introduction to apcf</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rnuske/apcf/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to apcf</h1>
                        <h4 data-toc-skip class="author">Robert
Nuske</h4>
            
            <h4 data-toc-skip class="date">2020-03-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rnuske/apcf/blob/master/vignettes/intro.Rmd" class="external-link"><code>vignettes/intro.Rmd</code></a></small>
      <div class="d-none name"><code>intro.Rmd</code></div>
    </div>

    
    
<p>The apcf package provides methods to analyse patterns of objects of
finite size and irregular shape using the adapted Pair-Correlation
Function (PCF) as proposed by Nuske et al. (2009).</p>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>The method suggested by Nuske et al. (2009) requires a certain number
of null models for correcting the biased PCF and constructing a
pointwise critical envelope. Null models are constructed by randomly
moving (shift and rotation) the objects within the study area.</p>
<p>The alpha level of the pointwise critical envelope is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mrow><mi>n</mi><mi>_</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>k</mi><mo>*</mo><mn>2</mn></mrow><mi>/</mi><mrow><mi>n</mi><mi>_</mi><mi>s</mi><mi>i</mi><mi>m</mi><mo>+</mo><mn>1</mn></mrow></mrow><annotation encoding="application/x-tex">\alpha = {n\_rank * 2} / {n\_sim + 1}</annotation></semantics></math>
according to (Besag and Diggle 1977, Buckland 1984, Stoyan and Stoyan
1994).</p>
<p>For the edge correction (based on Ripley 1981) a buffer with buffer
distance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>r</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">r_{ij}</annotation></semantics></math>
is constructed around the object <em>i</em> for each pair of objects
<em>i</em> and <em>j</em>. The object <em>j</em> is then weighted by the
inverse of the proportion
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">p_{ij}</annotation></semantics></math>
of the buffer perimeter being within the study area.</p>
<p>Being a density function the frequently used Epanechnikov kernel
(Silverman 1986, Stoyan and Stoyan 1994) is used for smoothing the PCF.
The smoothing is controlled by the bandwith parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>δ</mi><annotation encoding="application/x-tex">\delta</annotation></semantics></math>
and the step size <em>r</em>. Penttinen et al. (1992) and Stoyan and
Stoyan (1994) suggest to set <em>c</em> aka stoyan-parameter of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>/</mi><msqrt><mi>λ</mi></msqrt></mrow><annotation encoding="application/x-tex">c / {\sqrt{\lambda}}</annotation></semantics></math>
between 0.1 and 0.2 with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
being the intensity of the pattern.</p>
<p>To separate the computationally intensive part (randomization of the
objects and the calculation of the proportion of the buffer inside the
study area) from the smoothing of the PCF we use a two step
approach:</p>
<ul>
<li>calculate distances and buffer fractions for original and randomized
patterns</li>
<li>turn the distances and buffer fractions into a PCF together with a
pointwise critical envelope</li>
</ul>
</div>
<div class="section level2">
<h2 id="example-data">Example Data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<p>To present the workflow we make use of the simulated patterns
presented in Nuske et al. (2009). WKB representations of the data are
part of this package and documented as <code><a href="../reference/sim_patterns.html">?sim_patterns</a></code>.</p>
<div class="float">
<img src="../reference/figures/sim_pat.png" alt="Simulated patterns (a: regular, b: random, c: clustered)"><div class="figcaption">Simulated patterns (a: regular, b: random, c:
clustered)</div>
</div>
</div>
<div class="section level2">
<h2 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h2>
<div class="section level3">
<h3 id="pattern-to-distances">Pattern to Distances<a class="anchor" aria-label="anchor" href="#pattern-to-distances"></a>
</h3>
<p><code><a href="../reference/pat2dists.html">pat2dists()</a></code> calculates distances between all object of a
pattern closer than <code>max_dist</code> and determines the fraction of
a buffer with distance <code>dist</code> inside the study area (needed
for edge correction). It randomizes the original pattern to generate
<code>n_sim</code> null models used for correcting the biased PCF and
constructing an envelope. It’s advised against setting
<code>n_sim &lt; 199</code>, better still is 999 or even 9999.</p>
<p>It returns an object of class <code>dists</code> containing a
data.frame with the columns <code>sim</code>, <code>dist</code>, and
<code>prop</code> with an indicator of the model run
(<code>0:n_sim</code>), distances between the objects of the patterns,
and the proportion of a buffer with distance dist inside the study area.
The size of the study area, the total number of objects, and the maximum
distance are passed along as well.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># it's advised against setting n_sim &lt; 199</span></span>
<span><span class="va">dists</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pat2dists.html">pat2dists</a></span><span class="op">(</span>area<span class="op">=</span><span class="va">sim_area</span>, pattern<span class="op">=</span><span class="va">sim_pat_reg</span>, </span>
<span>                   max_dist<span class="op">=</span><span class="fl">25</span>, n_sim<span class="op">=</span><span class="fl">9</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dists</span><span class="op">)</span></span>
<span><span class="co">##   sim     dist     ratio</span></span>
<span><span class="co">## 1   0 24.64786 0.9239901</span></span>
<span><span class="co">## 2   0 17.15450 1.0000000</span></span>
<span><span class="co">## 3   0 20.22583 1.0000000</span></span>
<span><span class="co">## 4   0 20.04445 1.0000000</span></span>
<span><span class="co">## 5   0 24.13972 0.9517079</span></span>
<span><span class="co">## 6   0 19.67695 1.0000000</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="distances-to-pcf">Distances to PCF<a class="anchor" aria-label="anchor" href="#distances-to-pcf"></a>
</h3>
<p><code><a href="../reference/dists2pcf.html">dists2pcf()</a></code> estimates the adapted pair correlation
function of a pattern of polygons together with a pointwise critical
envelope using kernel methods based on distances between objects.</p>
<p>It returns an object of class <code>fv_pcf</code> containing the
function values of the PCF and the pointwise critical envelope. The
number of null models, the rank of envelope value among the n_sim values
and the bandwith/stoyan parameter are passed along.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pcf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dists2pcf.html">dists2pcf</a></span><span class="op">(</span><span class="va">dists</span>, r<span class="op">=</span><span class="fl">0.2</span>, r_max<span class="op">=</span><span class="fl">25</span>, stoyan<span class="op">=</span><span class="fl">0.15</span>, n_rank<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pcf</span><span class="op">)</span></span>
<span><span class="co">## PCF with pointwise critical envelopes</span></span>
<span><span class="co">## Obtained from 9 simulations</span></span>
<span><span class="co">## Edge correction: "Ripley"</span></span>
<span><span class="co">## Alternative: "two.sided"</span></span>
<span><span class="co">## Significance level of pointwise Monte Carlo test: 0.2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     r           g       lwr      upr</span></span>
<span><span class="co">## 1 0.2 0.000000000 0.7463425 1.269865</span></span>
<span><span class="co">## 2 0.4 0.000000000 0.7422944 1.234590</span></span>
<span><span class="co">## 3 0.6 0.000000000 0.7676460 1.206157</span></span>
<span><span class="co">## 4 0.8 0.000000000 0.7866854 1.186933</span></span>
<span><span class="co">## 5 1.0 0.005908318 0.8225105 1.177069</span></span>
<span><span class="co">## 6 1.2 0.013306581 0.8623679 1.173386</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plotting-the-pcf">Plotting the PCF<a class="anchor" aria-label="anchor" href="#plotting-the-pcf"></a>
</h3>
<p><code><a href="../reference/plot.fv_pcf.html">plot.fv_pcf()</a></code> is a plot method for the class
<code>fv_pcf</code>. It draws a pair correlation function and a
pointwise critical envelope if available.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pcf</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-4-1.png" width="384"></p>
<p>A plot of PCFs of the simulated patterns shown above having (a)
regular, (b) random, and (c) clustered objects. Black line: estimated
function; white line: theoretical value of the function under the null
hypothesis of complete spatial randomness; grey area: 95% confidence
envelope under the null hypothesis, computed by Monte Carlo simulation
using 199 replicates. Values g(r) &lt; 1 suggest inhibition between
points and values g(r) &gt; 1 suggest clustering.</p>
<div class="float">
<img src="../reference/figures/sim_pcf.png" alt="PCF of simulated patterns (a: regular, b: random, c: clustered)"><div class="figcaption">PCF of simulated patterns (a: regular, b:
random, c: clustered)</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="technical-details">Technical Details<a class="anchor" aria-label="anchor" href="#technical-details"></a>
</h2>
<p>The adapted pair-correlation functions was original implemented in
the Geodatabase <code>PostGIS</code>. <code>PostGIS</code> offers all
necessary geoprocessing methods and is easy to handle knowing databases
and SQL. The need to create many temporary tables and countless
transformations of the geodata stored as WKB in the database into the
“GEOS” format for geometric operations made the process very slow.</p>
<p>In this package the geometric operations (measuring distances between
objects, buffers, intersects, and randomly moving objects) are carried
out by <a href="https://libgeos.org" class="external-link"><code>GEOS</code></a>. The geodata
is read and transformed to <code>GEOS</code> format only once. All
further manipulations are within the <code>GEOS</code> world. Using the
GEOS library from R was made possible by <a href="https://www.rcpp.org" class="external-link"><code>Rcpp</code></a>.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Besag, J. and Diggle, P.J. (1977): Simple Monte Carlo tests for
spatial pattern. Journal of the Royal Statistical Society. Series C
(Applied Statistics), 26(3): 327–333.</p>
<p>Buckland, S.T. (1984): Monte Carlo Confidence Intervals. Biometrics,
40(3): 811–817.</p>
<p>Nuske, R.S., Sprauer, S. and Saborowski, J. (2009): Adapting the
pair-correlation function for analysing the spatial distribution of
canopy gaps. Forest Ecology and Management, 259(1): 107–116.</p>
<p>Ripley, B.D. (1981): Spatial Statistics. John Wiley &amp; Sons, New
York.</p>
<p>Silverman, B.W. (1986): Density Estimation for Statistics and Data
Analysis. Chapman and Hall, London.</p>
<p>Stoyan, D. and Stoyan, H. (1994) Fractals, random shapes and point
fields: Methods of geometrical statistics. John Wiley &amp; Sons,
Chichester.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert Nuske.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
