<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to apcf • apcf</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to apcf">
<meta property="og:description" content="apcf">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">apcf</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.7.902</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Introduction to apcf</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rnuske/apcf/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="intro_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to apcf</h1>
                        <h4 data-toc-skip class="author">Robert Nuske</h4>
            
            <h4 data-toc-skip class="date">2020-02-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rnuske/apcf/blob/HEAD/vignettes/intro.Rmd" class="external-link"><code>vignettes/intro.Rmd</code></a></small>
      <div class="hidden name"><code>intro.Rmd</code></div>

    </div>

    
    
<p>The apcf package provides methods to analyse patterns of objects of finite size and irregular shape using the adapted Pair-Correlation Function (PCF) as proposed by Nuske et al. (2009).</p>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>The method suggested by Nuske et al. (2009) requires a certain number of null models for correcting the biased PCF and constructing a pointwise critical envelope. Null models are constructed by randomly moving (shift and rotation) the objects within the study area.</p>
<p>The alpha level of the pointwise critical envelope is <span class="math inline">\(\alpha = {n\_rank * 2} / {n\_sim + 1}\)</span> according to (Besag and Diggle 1977, Buckland 1984, Stoyan and Stoyan 1994).</p>
<p>For the edge correction (based on Ripley 1981) a buffer with buffer distance <span class="math inline">\(r_{ij}\)</span> is constructed around the object <em>i</em> for each pair of objects <em>i</em> and <em>j</em>. The object <em>j</em> is then weighted by the inverse of the proportion <span class="math inline">\(p_{ij}\)</span> of the buffer perimeter being within the study area.</p>
<p>Being a density function the frequently used Epanechnikov kernel (Silverman 1986, Stoyan and Stoyan 1994) is used for smoothing the PCF. The smoothing is controlled by the bandwith parameter <span class="math inline">\(\delta\)</span> and the step size <em>r</em>. Penttinen et al. (1992) and Stoyan and Stoyan (1994) suggest to set <em>c</em> aka stoyan-parameter of <span class="math inline">\(c / {\sqrt{\lambda}}\)</span> between 0.1 and 0.2 with <span class="math inline">\(\lambda\)</span> being the intensity of the pattern.</p>
<p>To separate the computationally intensive part (randomization of the objects and the calculation of the proportion of the buffer inside the study area) from the smoothing of the PCF we use a two step approach:</p>
<ul>
<li>calculate distances and buffer fractions for original and randomized patterns</li>
<li>turn the distances and buffer fractions into a PCF together with a pointwise critical envelope</li>
</ul>
</div>
<div class="section level2">
<h2 id="example-data">Example Data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<p>To present the workflow we make use of the simulated patterns presented in Nuske et al. (2009). Shapefiles and WKB representations of the data are part of this package and documented as <code><a href="../reference/sim_patterns.html">?sim_patterns</a></code>.</p>
<div class="figure">
<img src="simulated_patterns.png" alt=""><p class="caption">Simulated patterns (a: regular, b: random, c: clustered)</p>
</div>
</div>
<div class="section level2">
<h2 id="from-pattern-to-distances">From Pattern to Distances<a class="anchor" aria-label="anchor" href="#from-pattern-to-distances"></a>
</h2>
<p><code><a href="../reference/pat2dists.html">pat2dists()</a></code> calculates distances between all object of a pattern closer than <code>max_dist</code> and determines the fraction of a buffer with distance <code>dist</code> inside the study area (needed for edge correction). It randomizes the original pattern to generate <code>n_sim</code> null models used for correcting the biased PCF and constructing an envelope. It’s advised against setting <code>n_sim &lt; 199</code>, better still is 999 or even 9999.</p>
<p>It returns an object of class <code>dists</code> containing a data.frame with the columns <code>sim</code>, <code>dist</code>, and <code>prop</code> with an indicator of the model run (<code>0:n_sim</code>), distances between the objects of the patterns, and the proportion of a buffer with distance dist inside the study area. The size of the study area, the total number of objects, and the maximum distance are passed along as well.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># it's advised against setting n_sim &lt; 199</span>
<span class="va">dists</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pat2dists.html">pat2dists</a></span><span class="op">(</span>area<span class="op">=</span><span class="va">sim_area_wkb</span>, pattern<span class="op">=</span><span class="va">sim_pat_reg_wkb</span>,
                   max_dist<span class="op">=</span><span class="fl">25</span>, n_sim<span class="op">=</span><span class="fl">9</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dists</span><span class="op">)</span>
<span class="co">##   sim     dist     ratio</span>
<span class="co">## 1   0 24.65000 0.9238066</span>
<span class="co">## 2   0 17.15157 1.0000000</span>
<span class="co">## 3   0 20.22589 1.0000000</span>
<span class="co">## 4   0 20.04445 1.0000000</span>
<span class="co">## 5   0 24.13877 0.9517043</span>
<span class="co">## 6   0 19.67296 1.0000000</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="from-distances-to-pcf">From Distances to PCF<a class="anchor" aria-label="anchor" href="#from-distances-to-pcf"></a>
</h2>
<p><code><a href="../reference/dists2pcf.html">dists2pcf()</a></code> estimates the adapted pair correlation function of a pattern of polygons together with a pointwise critical envelope using kernel methods based on distances between objects.</p>
<p>It returns an object of class <code>fv_pcf</code> containing the function values of the PCF and the pointwise critical envelope. The number of null models, the rank of envelope value among the n_sim values and the bandwith/stoyan parameter are passed along.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pcf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dists2pcf.html">dists2pcf</a></span><span class="op">(</span><span class="va">dists</span>, r<span class="op">=</span><span class="fl">0.2</span>, r_max<span class="op">=</span><span class="fl">25</span>, stoyan<span class="op">=</span><span class="fl">0.15</span>, n_rank<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pcf</span><span class="op">)</span>
<span class="co">## PCF with pointwise critical envelopes</span>
<span class="co">## Obtained from 9 simulations</span>
<span class="co">## Edge correction: "Ripley"</span>
<span class="co">## Alternative: "two.sided"</span>
<span class="co">## Significance level of pointwise Monte Carlo test: 0.2</span>
<span class="co">## </span>
<span class="co">##     r           g       lwr      upr</span>
<span class="co">## 1 0.2 0.000000000 0.6451025 1.266595</span>
<span class="co">## 2 0.4 0.000000000 0.6203820 1.214719</span>
<span class="co">## 3 0.6 0.000000000 0.6353140 1.184803</span>
<span class="co">## 4 0.8 0.000000000 0.6857767 1.187771</span>
<span class="co">## 5 1.0 0.005324562 0.7474053 1.187196</span>
<span class="co">## 6 1.2 0.012042414 0.7903258 1.178189</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plotting-the-pcf">Plotting the PCF<a class="anchor" aria-label="anchor" href="#plotting-the-pcf"></a>
</h2>
<p><code><a href="../reference/plot.fv_pcf.html">plot.fv_pcf()</a></code> is a plot method for the class <code>fv_pcf</code>. It draws a pair correlation function and a pointwise critical envelope if available.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pcf</span><span class="op">)</span></code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-4-1.png" width="384"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># a panel of four plots</span>
<span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>,
          mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">0.5</span>,<span class="fl">0</span><span class="op">)</span>, tcl<span class="op">=</span><span class="op">-</span><span class="fl">0.3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pcf</span>, xaxis<span class="op">=</span><span class="st">'t'</span>, yaxis<span class="op">=</span><span class="st">'o'</span>, ann<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pcf</span>, xaxis<span class="op">=</span><span class="st">'t'</span>, yaxis<span class="op">=</span><span class="st">'t'</span>, ann<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pcf</span>, xaxis<span class="op">=</span><span class="st">'o'</span>, yaxis<span class="op">=</span><span class="st">'o'</span>, ann<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pcf</span>, xaxis<span class="op">=</span><span class="st">'o'</span>, yaxis<span class="op">=</span><span class="st">'t'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="technical-details">Technical Details<a class="anchor" aria-label="anchor" href="#technical-details"></a>
</h2>
<p>The adapted pair-corelation functions was original implemented in the Geodatabase <code>PostGIS</code>. <code>PostGIS</code> offers all necessary geoprocessing methods and is easy to handle knowing databases and SQL. The need to create lots of temporary tables and countless transformations of geodata from WKB stored in the table to the <code>GEOS</code> format for geometric operations rendered the process quite slow.</p>
<p>In this package the geometric operations (measuring distances between objects, buffers, intersects, and randomly moving objects) are carried out by <a href="https://libgeos.org" class="external-link"><code>GEOS</code></a>. The geodata is read and transformed to <code>GEOS</code> format only once. All further manipulations are within the <code>GEOS</code> world. The usage of the GEOS library was made possible by <a href="http://www.rcpp.org" class="external-link"><code>Rcpp</code></a>.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Besag, J. and Diggle, P.J. (1977): Simple Monte Carlo tests for spatial pattern. Journal of the Royal Statistical Society. Series C (Applied Statistics), 26(3): 327–333. <a href="https://doi.org/10.2307/2346974" class="external-link uri">https://doi.org/10.2307/2346974</a></p>
<p>Buckland, S.T. (1984): Monte Carlo Confidence Intervals. Biometrics, 40(3): 811–817. <a href="https://doi.org/10.2307/2530926" class="external-link uri">https://doi.org/10.2307/2530926</a></p>
<p>Nuske, R.S., Sprauer, S. and Saborowski, J. (2009): Adapting the pair-correlation function for analysing the spatial distribution of canopy gaps. Forest Ecology and Management, 259(1): 107–116. <a href="https://doi.org/10.1016/j.foreco.2009.09.050" class="external-link uri">https://doi.org/10.1016/j.foreco.2009.09.050</a></p>
<p>Ripley, B.D. (1981): Spatial Statistics. John Wiley &amp; Sons, New York. <a href="https://doi.org/10.1002/0471725218" class="external-link uri">https://doi.org/10.1002/0471725218</a></p>
<p>Silverman, B.W. (1986): Density Estimation for Statistics and Data Analysis. Chapman and Hall, London.</p>
<p>Stoyan, D. and Stoyan, H. (1994) Fractals, random shapes and point fields: Methods of geometrical statistics. John Wiley &amp; Sons, Chichester.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Robert Nuske.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
